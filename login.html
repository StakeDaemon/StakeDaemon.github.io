<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Wallet Debug Page</title>
</head>
<body style="background:#111; color:white; font-family:Arial; text-align:center; padding-top:40px;">

  <h2>Wallet Connection Debug</h2>

  <button id="connectETH" style="padding:10px 20px; margin:10px;">Connect Ethereum</button>
  <button id="connectSOL" style="padding:10px 20px; margin:10px;">Connect Solana</button>

  <pre id="debug" style="text-align:left; margin:30px auto; width:90%; background:#000; padding:20px; border-radius:10px; color:#00ff90; max-width:600px;"></pre>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js"

    const supabase = createClient(
      "YOUR_SUPABASE_URL",
      "YOUR_SUPABASE_ANON_KEY"
    )

    const debug = document.getElementById("debug")

    function log(x) {
      debug.textContent += x + "\n"
    }

    log("üîç Checking user session...")

    const { data: { user }, error: userErr } = await supabase.auth.getUser()

    if (userErr) log("‚ùå auth.getUser ERROR: " + JSON.stringify(userErr, null, 2))

    if (!user) {
      log("‚ùå No Supabase user found (you must login first).")
    } else {
      log("‚úÖ User loaded: " + user.id)
    }

    // ETH Connect
    document.getElementById("connectETH").onclick = async () => {
      log("\n=== ETHEREUM CONNECT ===")

      if (!window.ethereum) {
        log("‚ùå MetaMask not installed.")
        return
      }

      const accounts = await window.ethereum.request({ method: "eth_requestAccounts" })
      const eth = accounts[0]

      log("ETH Address: " + eth)
      log("Saving to Supabase...")

      const { data, error } = await supabase
        .from("users")
        .update({ eth_wallet: eth })
        .eq("id", user.id)
        .select()

      log("Supabase response: " + JSON.stringify({ data, error }, null, 2))
    }

    // SOL Connect
    document.getElementById("connectSOL").onclick = async () => {
      log("\n=== SOLANA CONNECT ===")

      const provider = window.phantom?.solana
      if (!provider?.isPhantom) {
        log("‚ùå Phantom not installed.")
        return
      }

      const resp = await provider.connect()
      const sol = resp.publicKey.toString()

      log("SOL Address: " + sol)
      log("Saving to Supabase...")

      const { data, error } = await supabase
        .from("users")
        .update({ sol_wallet: sol })
        .eq("id", user.id)
        .select()

      log("Supabase response: " + JSON.stringify({ data, error }, null, 2))
    }
  </script>
</body>
</html>
